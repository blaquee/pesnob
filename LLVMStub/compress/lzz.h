#ifndef LZZ_H
#define LZZ_H

#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <memory.h>
#include <io.h>
#include <time.h>

#undef USE_HUFF

//#pragma extref _floatconvert

#define TREE_MAX        65536    // ??кс. к??-?? э?-т?? ??р???
#define TREE_DEPTH      8        // ??кс. ????????сть ??р???
#define TREE_HINT_COUNT 1        // ?????у?: 1 стр?к? ?? 8 к??., ???ч?
#define TREE_HINT_RANGE 8192     //            у????ть стр?ку ?? ??р???
#define TREE_FILT_RANGE 1024     // ч?р?? ск??ьк? ???т ??????ять ??р???

//#define USE_HUFF                 // с????ть к??ы х?фф?????, ????ы? ?тст??

typedef unsigned char   unsigned char;
typedef unsigned short  unsigned short;
typedef unsigned long   unsigned long;

/*
#define min(a,b)        ((a)<(b)?(a):(b))
#define max(a,b)        ((a)>(b)?(a):(b))
*/

	typedef struct _node             // у??? ??р???. ??к?т?ры? э?-ты ?? ?с???ь?уются
	{
		unsigned long       count;          // ск??ьк? р?? стр?к? ?стр?ч???сь ? т?кст?
		unsigned long       hint;           // ск??ьк? стр?к ???????/с??т?
		unsigned long       lastoffs;       // ??с?????? ?ффс?т стр?к?
		unsigned long       level;          // ур????ь ????????ст? у??? = ????? стр?к?
		unsigned long       sym;            // char, т?кущ?? с?????
		unsigned long       index;          // ????р у??? ??р???
		struct _node        *prev;          // ?р??ы?ущ?? у???
		unsigned long       nextcount;      // ч?с?? ???у???ых э?????т?? ? next
		struct _node*       (*next)[256];   // NULL ??? ук???т??? ?? с???ующ?? э?-ты
	} node;

	node* root;                     // к?р??ь
	unsigned long nodecount;                // ч?с?? у???? ??? к?т?ры? ?ы?????? ???ять
	unsigned long tree_indexcount;          // ч?с?? у???? ??р???
	node* tree_index[TREE_MAX];     // ??сс?? ук???т???? ?? ?с? у??ы ??р???

	node* __cdecl tree_allocnode();
	void __cdecl tree_deallocnode(node** x);
	node* __cdecl tree_addnode(node** x, unsigned long i);
	void __cdecl tree_delnode(node** x);
	void __cdecl tree_init();
	void __cdecl tree_init1();
	void __cdecl tree_done();
	unsigned char* __cdecl tree_node2string(node* x);
	node* __cdecl tree_string2node(unsigned char* s);
	void __cdecl tree_update(unsigned char* s);
	void __cdecl tree_filter_node(node** x);
	void __cdecl tree_filter();
	void __cdecl tree_enum_node(node* x);
	void __cdecl tree_enum();
	void __cdecl tree_dump_node(node* x);
	void __cdecl tree_dump();

	//void showstat(dword max, dword i, dword o);
	void __cdecl encode_buf(unsigned char ibuf[], unsigned long isize, unsigned char obuf[], unsigned long *osize);
	void __cdecl decode_buf(unsigned char ibuf[], unsigned long isize, unsigned char obuf[], unsigned long osize);


#endif // LZZ_H


