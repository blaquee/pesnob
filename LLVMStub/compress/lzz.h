#ifndef LZZ_H
#define LZZ_H

#include <stdio.h>
#include <stdlib.h>
#include <assert.h>
#include <memory.h>
#include <io.h>
#include <time.h>

#undef USE_HUFF

//#pragma extref _floatconvert

#define TREE_MAX        65536    // ??кс. к??-?? э?-т?? ??р???
#define TREE_DEPTH      8        // ??кс. ????????сть ??р???
#define TREE_HINT_COUNT 1        // ?????у?: 1 стр?к? ?? 8 к??., ???ч?
#define TREE_HINT_RANGE 8192     //            у????ть стр?ку ?? ??р???
#define TREE_FILT_RANGE 1024     // ч?р?? ск??ьк? ???т ??????ять ??р???

//#define USE_HUFF                 // с????ть к??ы х?фф?????, ????ы? ?тст??

typedef unsigned char   byte;
typedef unsigned short  word;
typedef unsigned long   dword;

/*
#define min(a,b)        ((a)<(b)?(a):(b))
#define max(a,b)        ((a)>(b)?(a):(b))
*/

typedef struct _node             // у??? ??р???. ??к?т?ры? э?-ты ?? ?с???ь?уются
{
	dword       count;          // ск??ьк? р?? стр?к? ?стр?ч???сь ? т?кст?
	dword       hint;           // ск??ьк? стр?к ???????/с??т?
	dword       lastoffs;       // ??с?????? ?ффс?т стр?к?
	dword       level;          // ур????ь ????????ст? у??? = ????? стр?к?
	dword       sym;            // char, т?кущ?? с?????
	dword       index;          // ????р у??? ??р???
	struct _node        *prev;          // ?р??ы?ущ?? у???
	dword       nextcount;      // ч?с?? ???у???ых э?????т?? ? next
	struct _node*       (*next)[256];   // NULL ??? ук???т??? ?? с???ующ?? э?-ты
} node;

node* root;                     // к?р??ь
dword nodecount;                // ч?с?? у???? ??? к?т?ры? ?ы?????? ???ять
dword tree_indexcount;          // ч?с?? у???? ??р???
node* tree_index[TREE_MAX];     // ??сс?? ук???т???? ?? ?с? у??ы ??р???

	node* tree_allocnode();
	void tree_deallocnode(node** x);
	node* tree_addnode(node** x, dword i);
	void tree_delnode(node** x);
	void tree_init();
	void tree_init1();
	void tree_done();
	byte* tree_node2string(node* x);
	node* tree_string2node(byte* s);
	void tree_update(byte* s);
	void tree_filter_node(node** x);
	void tree_filter();
	void tree_enum_node(node* x);
	void tree_enum();
	void tree_dump_node(node* x);
	void tree_dump();

	void showstat(dword max, dword i, dword o);
	void encode_buf(byte ibuf[], dword isize, byte obuf[], dword *osize);
	void decode_buf(byte ibuf[], dword isize, byte obuf[], dword osize);
#endif // LZZ_H


